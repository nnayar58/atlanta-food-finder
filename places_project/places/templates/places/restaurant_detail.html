<!DOCTYPE html>
<html lang="en">
<head>
    {% load static %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ restaurant.name|default:"Restaurant Details" }}</title>
    <link rel="stylesheet" href="{% static 'style/restaurant_detail2.css' %}">
</head>
<body>
<div class="container">
    <div class="home-header-container">
        <button onclick="window.location.href='{% url 'home' %}';" class="logo-button">
            <img src="{% static 'logo.png' %}" alt="logo" class="logo">
        </button>
        <div class="signin-container">
            <button onClick="window.location.href='{% url 'search_places' %}';" class="search-header-button">
                <img src="{% static 'search-icon.png' %}" alt="search-icon" style="min-width:120%;">
            </button>
            <div id="userGreeting" class="user-greeting"></div>
            <div id="dropdownMenu" class="dropdown-menu" style="display: none;">
                <a href="{% url 'account' %}" class="dropdown-link">My Account</a>
                <a href="{% url 'favorites' %}" class="dropdown-link">My Favorites</a>
                <a href="#" id="logoutButton" class="dropdown-link">Log Out</a>
            </div>
        </div>
    </div>
    <div class="main-content">
        <div class="details-column">
            <h1>{{ restaurant.name|default:"Restaurant Details" }}</h1>
            <p><strong>Address:</strong> {{ restaurant.formatted_address|default:"Not available" }}</p>
            <p><strong>Contact:</strong> {{ restaurant.formatted_phone_number|default:"Not available" }}</p>
            <p><strong>Cuisine Type:</strong> {{ restaurant.types|join:", "|default:"Not specified" }}</p>
            <p><strong>Rating:</strong> {{ restaurant.rating|default:"No rating" }} ({{ restaurant.user_ratings_total|default:"0" }} reviews)</p>

            <h2>Reviews</h2>
            {% if restaurant.reviews %}
            <ul>
                {% for review in restaurant.reviews %}
                <li>
                    <strong>{{ review.author_name }}</strong> ({{ review.rating }} stars)
                    <p>{{ review.text }}</p>
                </li>
                {% endfor %}
            </ul>
            {% else %}
            <p>No reviews available.</p>
            {% endif %}
        </div>

        <div class="map-column">
            <h2>Location</h2>
            <div id="map" style="height: 400px;"></div>
        </div>
    </div>
</div>

<script>
    function initMap() {
        const location = {
            lat: {{ restaurant.geometry.location.lat|default:"0" }},
            lng: {{ restaurant.geometry.location.lng|default:"0" }},
        };

        const map = new google.maps.Map(document.getElementById("map"), {
            zoom: 14,
            center: location,
        });

        const marker = new google.maps.Marker({
            position: location,
            map: map,
        });
    }
</script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        const userData = JSON.parse(localStorage.getItem('userData'));  // Get user data from localStorage
        const userGreetingDiv = document.getElementById('userGreeting');
        const dropdownMenu = document.getElementById('dropdownMenu');
        const logoutButton = document.getElementById('logoutButton');

        if (userData) {
            // User is logged in, show greeting
            userGreetingDiv.innerHTML = `Hello, ${userData.firstName}`;
            userGreetingDiv.style.cursor = 'pointer';

            // Toggle dropdown menu on click
            userGreetingDiv.addEventListener('click', function() {
                dropdownMenu.style.display = dropdownMenu.style.display === 'block' ? 'none' : 'block';
            });
        } else {
            // User is not logged in, show sign-in button
            userGreetingDiv.innerHTML = '<button onClick="window.location.href=\'{% url 'login' %}\'" class="signin">Sign In</button>';
        }

        // Log out logic
        logoutButton.addEventListener('click', function() {
            localStorage.removeItem('userData');
            localStorage.removeItem('loggedInUserId');
            window.location.href = '{% url 'home' %}';  // Redirect to home page after logout
        });

        // Hide dropdown when clicking outside of it
        document.addEventListener('click', function(event) {
            if (!userGreetingDiv.contains(event.target) && !dropdownMenu.contains(event.target)) {
                dropdownMenu.style.display = 'none';
            }
        });
    });
</script>
<script src="https://maps.googleapis.com/maps/api/js?key={{ api_key }}&callback=initMap" async defer></script>
</body>
</html>
